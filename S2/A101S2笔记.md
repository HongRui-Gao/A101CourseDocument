# S2 笔记

[HongRui-Gao/A101CourseDocument: 北大青鸟A101上课笔记 (github.com)](https://github.com/HongRui-Gao/A101CourseDocument)

## 1. C# OOP 

### 一. 三层架构

#### 1.1 三层介绍

> 分层的好处：把原本写在一个项目当中所有内容按照功能进行分类，方便我们日后维护

三层架构包含的三层：

（1）数据访问层： 专门用于创建数据库连接以及进行数据库操作   ---》 DAL

（2）业务逻辑层： 专门用于处理业务上的逻辑操作与判断  ---》 BLL

（3）表示层：         专门用于存放显示效果的    ---》 WinApp



> 除了上面的三层，我们书写项目的时候一般还会多创建一层，用于存放数据库映射关系，这层主要就是根据数据库当中表，创建一个对应的类，在这个类把表当中所有的列以封装的形式进行书写 ,它的起名叫做Model

C#创建项目的项目类型： **类库**

#### 1.2 类库

类库是专门用于存储类文件的仓库，它的结构基本与我们之前学习的控制台程序比较像，与控制台项目不同的是类库是**不带有启动功能**的

#### 1.3 创建现在项目的结构

创建步骤：

	1. 创建一个Windows应用程序，起名为WinApp
	1. 点击解决方案资源管理器当中的解决方案，鼠标右键，选择添加，选择新建项目

![](images/01.png)

点击完成之后，会弹出一个新的界面，之后我们去选择类库，改一下名字，这个名字要求是三层架构当中所拥有的名称

![](images/2.png)

之后重复该步骤创建 Model层，DAL层以及BLL层，创建完成之后，效果如下：

![](images/3.png)

3.  我们需要去名字叫做Model的类库当中，书写对应的数据库映射内容 ----》 封装

写法是找到我们要操作的数据库当中的表，然后按照表名创建一个对应的类，之后在这个类当中封装数据库表里的每一个列

> C# 当中带有2种封装，（1）显示封装 （2）隐式封装
>
> （1）显示封装的语法：
>
>  ``` c#
>  private 数据类型 字段名; //声明字段，微软公司对封装的字段名有要求，要求以_为开头，后面写正常的名字，采用驼峰命名法 _nickName
>  
>  public 数据类型 属性名 //属性要求与字段名相同（不带有下划线，并且采用Pascal命名法 NickName）
>  {
>      set{ 字段名 = value;}
>      get{ return 字段名;}
>  }
>  ```
>
> （2）隐式封装的语法：
>
> ``` C#
> public 数据类型 属性名{ get;set; }
> ```
>
> 

4. 我们去数据访问层DAL当中进行操作，

​		（1）我们需要在DAL类库下，找到引用鼠标右键（References），选择添加引用

![](images/4.png)

​		它会打开一个新的界面，让我们来选择要添加进这个项目的引用，界面如下：

![](images/5.png)

我们需要选中 :

​	a. 程序集里面的 **System.Configuration**

​    b. 解决方案当中的 **Model** 

之后我们点击确定即可，其中System.Configuration 这个是让我们添加系统配置的，这个配置信息一般是存在于WinApp下的App.config文件当中

​		（2）书写每个表的数据库操作内容，例如： 新增操作，修改操作，删除操作，查询操作等

​					（a）创建一个类 SqlHelper ,因为分层了，我们现在要求对这个类进行更新。

​							  去WinApp下的App.config文件当中Configuration标签中添加数据库连接设定

``` xml
  <connectionStrings>
    <add name="自己起的名字" 
         connectionString="Data Source=.;Initial Catelog=数据库名;User Id = sa;PWD=自己的登入密码" 
         providerName="System.Data.SqlClient"/>
  </connectionStrings>
```

​				（b） 在SqlHelper类当中获取上面的配置信息

``` C#
 static string constr = ConfigurationManager.ConnectionStrings["配置语句的名字"].ConnectionString;
```

​				（c） 每个执行方法都添加一个对应的占位符的值

``` C#
// 2. 书写增删改或者查询的方法
        /// <summary>
        /// 增删改方法
        /// </summary>
        /// <param name="sql">要执行的SQL语句</param>
        /// <param name="param">存放要存入的值</param>
        /// <returns></returns>
        public static int ExecuteNonQuery(string sql , SqlParameter[] param) 
        {
            //Parameter 这个单词代表参数，现在S2的写法要求SQL语句不能直接通过“”++进行拼写，因为这种写法
            //容易被SQL注入攻击

            try
            {
                con = new SqlConnection(constr); //创建连接对象
                con.Open(); //打开数据库连接
                cmd = new SqlCommand(sql, con); //创建数据库命令对象
                if (param != null)
                {
                    cmd.Parameters.AddRange(param); //把数据库语句的占位符值，添加到命令对象当中
                }
                return cmd.ExecuteNonQuery();

            }
            catch (Exception)
            {
                throw;
            }
            finally 
            {
                cmd.Dispose();
                con.Dispose();
            }

       }
```

S2新的SqlHelper完整代码如下：

``` C#
using System.Data;
using System.Data.SqlClient;
using System.Configuration; //引入系统配置

namespace DAL
{
    public static class SqlHelper
    {
        // 1. 从系统配置文件（App.config）当中读取对应的数据库连接语句
        static string constr = ConfigurationManager.ConnectionStrings["MySqlStr"].ConnectionString;
        static SqlConnection con = null;
        static SqlCommand cmd = null;
        static SqlDataAdapter sda = null;

        // 2. 书写增删改或者查询的方法
        /// <summary>
        /// 增删改方法
        /// </summary>
        /// <param name="sql">要执行的SQL语句</param>
        /// <param name="param">存放要存入的值</param>
        /// <returns></returns>
        public static int ExecuteNonQuery(string sql , SqlParameter[] param) 
        {
            //Parameter 这个单词代表参数，现在S2的写法要求SQL语句不能直接通过“”++进行拼写，因为这种写法
            //容易被SQL注入攻击

            try
            {
                con = new SqlConnection(constr); //创建连接对象
                con.Open(); //打开数据库连接
                cmd = new SqlCommand(sql, con); //创建数据库命令对象
                if (param != null)
                {
                    cmd.Parameters.AddRange(param); //把数据库语句的占位符值，添加到命令对象当中
                }
                return cmd.ExecuteNonQuery();

            }
            catch (Exception)
            {
                throw;
            }
            finally 
            {
                cmd.Dispose();
                con.Dispose();
            }

        }

        /// <summary>
        /// 查询方法
        /// </summary>
        /// <param name="sql">要执行的SQL语句</param>
        /// <param name="param">SQL语句当中占位符的对应的值</param>
        /// <returns>系统虚表</returns>
        public static DataTable Query(string sql, SqlParameter[] param) 
        {
            try
            {
                sda = new SqlDataAdapter(sql, constr);
                DataTable dt = new DataTable();
                if (param != null)
                {
                    sda.SelectCommand.Parameters.AddRange(param);
                }
                sda.Fill(dt);
                return dt;
            }
            catch (Exception)
            {
                throw;
            }
            finally 
            {
                sda.Dispose();
            }
        }
    
    }
}
```

我们再去创建一个类，这个类起名要求以对应的表名为开头后面加上Dal后缀，代表是数据访问层的类，例如： StudentDal

5. 书写BLL层  ---》 业务逻辑层

​		a. 添加引用，在BLL下选择引用，鼠标右键添加引用，之后直接找解决方案当中Model,DAL，就添加这两个内容。

​        b. 创建一个类，要求以对应的表名开头，以Bll为结尾，例如：StudentBll

​		c.  添加对前面两个层的引用

``` C#
using Model;
using DAL;
```

​        d. 在这个类当中创建一个对应的DAL层的对象

``` C#
StudentDal dal= new StudentDal();
```

​        e. 把对应Dal层的类当中的代码，复制粘贴过来，之后进行修改 

把复制过来的代码，当中所有的方法内容删掉，改为return 创建的对象名.当前方法名(参数名);,例如：

``` C#
    public class StudentBll
    {
        StudentDal dal = new StudentDal();
        public int Add(Student stu) 
        {
            return dal.Add(stu);
        }

    }
```

6.   我们在WinApp下，添加引用，把其他三个层全部引用过来

**注意： 在这个层后台代码当中一定不能出现DAL层的内容** 剩下操作就是正常的画界面，之后在代码页面添加两个引用

``` C#
using Model;
using BLL;
```

接下来在类当中实例化对象，

``` C#
StudentBll bll = new StudentBll();
```

最后在需要的使用通过这个对象来调用对应的方法，即可。

#### 备注

##### 1. SqlHelper当中执行聚合函数的方法

``` C#
public static object ExecuteScalar(string sql,SqlParameter[] param)
{
    try
    {
        con = new SqlConnection(constr); //创建连接对象，存入数据库连接语句
        con.Open();
        cmd = new SqlCommand(sql,con);
        if(param != null)
        {
            cmd.Parameters.AddRange(param);
        }
        return cmd.ExecuteScalar();
    }
    catch(Exception ex)
    {
        throw ex;
    }
    finally
    {
        cmd.Dispose();
        con.Dispose();
    }
}
```

该方法主要是执行只查询聚合函数的sql语句。

##### 2. Winform TreeView控件 

该控件主要制作的是属性图效果，例如，sql server数据库里面对象资源管理器的效果。该控件还可以可以绑定图片。

**常见属性**

| 属性       | 说明                                         |
| ---------- | -------------------------------------------- |
| ImageList  | 用于绑定图片集合，方便给里面的每项来绑定图标 |
| Nodes      | 该属性是用于获取当前位置下的所有节点信息     |
| SelectNode | 该属性是用于获取选中的节点信息               |

我们可以按照下面的语法来进行添加节点：

``` C#
控件名.Nodes.Add("节点内容"); //该内容是为了给当前控件添加一个根节点，节点显示内容是小括号当中的内容
控件名.Nodes[0].Nodes.Add("节点内容"); //该内容是为了给当前控件里的第一个根节点添加一个子节点，节点显示内容为括号当中内容
```

除此之外，我们还需要了解如何进行删除要的节点信息或者删除所有节点信息

``` C#
控件名.Nodes.Remove(节点信息); //删除该节点内容
控件名.Nodes.Clear(); // 删除所有根节点
控件名.Nodes[0].Nodes.Clear(); // 删除第一个根节点下所有节点信息
```



##### 3. 新的数据类型 Guid

这个数据类型是c#当中的编码类型，因为位数较多，基本不可能出现重复值。它在赋值的时候也是不需要我们手动往里存值的，我们只需要调用这个属性的方法即可。

``` c#
Guid id = Guid.NewGuid();
Console.WriteLine(id);
```

运行上面的代码，输出结果如下：

<img src="images/6.png" style="zoom: 80%;" />

这个数据类型的空值并不是null，它也是通过这个数据类型自己的属性来实现的

``` C#
Guid id = Guid.Empty;
Console.WriteLine(id);
```

效果如下：

<img src="images/7.png" style="zoom:80%;" />

该数据类型在Sql Server数据库当中对应的是uniqueidentifier，用于做唯一标识（主键列）进行使用，我们在数据库当中也可以对其进行存值，使用的是 NEWID() 函数。

##### 4. C# using 语句

C#添加引用的时候使用的就是using，但是我们这个地方的using语句并不是用于添加引用的，帮助我们快速的释放资源，需要我们写在类当中的方法里面。

我们在写SqlHelper的时总是需要释放掉连接对象，命令对象，数据适配器对象等等。我们现在可以使用这个语句来帮助我们。

**语法：**

``` C#
using(要进行创建的对象)
{
    这个里面存放的是正常代码    
}
```

语法当中小括号里面创建的对象只能在后面跟着的花括号当中找到。

例如：

``` C#
public static int ExecuteNonQuery(string sql,SqlParameter[] param)
{
    try
    {
        using(SqlConnection con = new SqlConnection(constr))
        {
            con.Open();
            using(SqlCommand cmd = new SqlCommand(sql,con))
            {
                if(param != null)
                {
                    cmd.Parameter.AddRange(param);
                }
                return cmd.ExecuteNonQuery();
            }
        }  
    }
    catch(Exception ex)
    {
        throw ex;
    }
}
```

下面内容是把S2新版的SqlHelper改为用using语句写法实现：

``` C#
using System.Data;
using System.Data.SqlClient;
using System.Configuration; //引入系统配置

namespace DAL
{
    public static class SqlHelper
    {
        // 1. 从系统配置文件（App.config）当中读取对应的数据库连接语句
        static string constr = ConfigurationManager.ConnectionStrings["MySqlStr"].ConnectionString;
        

        // 2. 书写增删改或者查询的方法
        /// <summary>
        /// 增删改方法
        /// </summary>
        /// <param name="sql">要执行的SQL语句</param>
        /// <param name="param">存放要存入的值</param>
        /// <returns></returns>
        public static int ExecuteNonQuery(string sql , SqlParameter[] param) 
        {
            //Parameter 这个单词代表参数，现在S2的写法要求SQL语句不能直接通过“”++进行拼写，因为这种写法
            //容易被SQL注入攻击

            try
            {
                using(SqlConnection con = new SqlConnection(constr))//创建连接对象
                {
                    con.Open(); //打开数据库连接
                    using(SqlCommand cmd = new SqlCommand(sql, con)) //创建数据库命令对象
                    {
                        if (param != null)
                		{
                    		cmd.Parameters.AddRange(param); //把数据库语句的占位符值，添加到命令对象当中		
                		}
                		return cmd.ExecuteNonQuery();
                    }
                } 
            }
            catch (Exception)
            {
                throw;
            }
        }

        /// <summary>
        /// 查询方法
        /// </summary>
        /// <param name="sql">要执行的SQL语句</param>
        /// <param name="param">SQL语句当中占位符的对应的值</param>
        /// <returns>系统虚表</returns>
        public static DataTable Query(string sql, SqlParameter[] param) 
        {
            try
            {
                using(SqlDataAdapter sda = new SqlDataAdapter(sql, constr))
                {
                    DataTable dt = new DataTable();
                    if (param != null)
                    {
                        sda.SelectCommand.Parameters.AddRange(param);
                    }
                    sda.Fill(dt);
                    return dt;
                }
            }
            catch (Exception)
            {
                throw;
            }
        }
    }
}
```



##### 5. MD5加密

让我们对需要安全等级较高的字符串数据进行加密操作的，我们项目当中一般主要对密码进行使用。

**使用步骤：**

（1）添加MD5操作的引用

``` C#
using System.Security.Cryptography; 
```

（2）在对应的代码位置上，去创建一个MD5对象

``` C#
MD5 md5 = MD5.Create();
```

（3）把要进行加密的字符串转换为字节数组

``` C#
byte[] bytes = Encoding.Default.GetBytes(要进行加密的字符串);
```

（4）把上面字节数组当中每个字节都进行加密，并且得到加密后的字节数组

``` C#
byte[] buffers = md5.ComputeHash(bytes,0,bytes.Length);
```

（5）把加密后的字节数组中的每个字节转换为字符串并且组成最终的字符串内容

``` C#
StringBuilder sb = new StringBuilder();
foreach(byte b in buffers)
{
    sb.Append(b.ToString("x2"));
}
```



### 二. WebForm

#### 1. 简介

WebForm是微软公司模仿Winform技术开发出来的一项Web开发技术，也是以拖拽式开发和控件内容为主的一种web开发方式。

WebForm文件的扩展名： .aspx

**WebForm是之前C#主流的开发模式之一，也被称为Asp.Net 开发技术**

#### 2. 创建项目

现在创建的项目是Web应用程序，创建完成的项目架构如下：

<img src="images/08.png" style="zoom:67%;" />

这种创建项目的方式会带有案例内容，所以我们在开发之前需要先去把没有用的内容删除掉，删除内容如下：

Account文件夹，About.aspx,Contact.aspx,Default.aspx,Site.Master

##### 2.1 创建项目之后，展示视图界面

![](images/09.png)



设计： 这个是让我们来进行查看网页效果

拆分： 这个是让我们能够一边手写代码，一边查看页面效果

源： 这个是我们书写页面代码的页面（这个是我们以后基本天天看的界面）

### 3. 页面代码

![](images/10.png)

<%%>  我们叫做小脚本写法，经常出现于webform以及JSP当中，这个对符号主要作用就是在HTML页面内允许我们插入一段C#或者Java代码

<%@ %> 这个是我们在html页面内插入一段配置信息，Page代表页面，Language代表当前页面开发语言为C#,AutoEventWireup 这个是配置当前页面是否开启事件自动验证，true代表开启， CodeBehind 用于设定后台编码文件，Inherits 这个用于设定当前页面所在的命名空间

**runat=“server” 属性与值**

 run 代表 运行 ， at 代表 在。。。  runat 代表运行在。。。。， server 代表服务， **我们现在学的webform所有的控件都必须带有这个属性，因为webform的控件都是运行在服务端上的**

**每个web窗体当中都必须带有一个form标签，我们写的所有页面代码都必须写在这对form标签当中**



### 4. 常见控件

有的人比较喜欢手写控件，控件的固定代码如下：

``` C#
<asp:控件名 Id="" runat="server" Text=""></asp:控件名>
```

> 个人建议：不要手写，去工具箱当中找到控件拖拽到想要存放该控件的位置

#### 4.1 Button控件

``` C#
<asp:Button ID="btnSave" runat="server" Text="Button"></asp:Button>
```

我们在设计视图找到该按钮控件，双击就可以对该控件添加事件，但是不建议这么做。我们最好是记住常见的事件名称。

| 事件名   | 说明                     |
| -------- | ------------------------ |
| OnClick  | 这个是控件单击事件       |
| OnChange | 这个是控件内容的更改事件 |

Webform的控件想要好看都需要通过样式表进行设置。

WebForm的控件想要引入样式（类选择器的）需要使用属性：CssClass 

#### 4.2 TextBox控件

文本框控件

``` C#
<asp:TextBox id="TextBox1" runat="server" Text="" ></asp:Text>
```

我们想要让上面的文本框变为密码框，只需要添加一个属性TextMode，里面属性值选择为Password

我们除了上面的属性以外，还需要多记住一个事件TextChanged,这个是文本更改事件

#### 4.3 RadioButton控件

单选按钮控件

``` C#
<asp:RadioButton ID="RadioButton1" runat="server" Text="男" GroupName="gender" Checked="true" />
```

**常见属性：**

| 属性名    | 属性说明                                                |
| --------- | ------------------------------------------------------- |
| Text      | 设定控件显示的文本信息                                  |
| GroupName | 用于对控件进行分组，同一组当中的单选按钮只能选中一个    |
| Checked   | 设定控件为默认选中，值true 默认选中,false为默认值不选中 |



#### 4.4 CheckBox控件

复选框，让我们选择多项。

``` C#
<asp:CheckBox ID="CheckBox1" runat="server" Text="xxx" Checked="true" />
```

属性内容与单选框相同

#### 4.5 DropDownList控件

这个是下拉列表控件，webform与winform使用方式基本相同。

**（1）不绑定数据库**

``` C#
 <asp:DropDownList ID="DropDownList1" runat="server">
           <asp:ListItem Value="S1">S1</asp:ListItem> <!-- 这个是列表项 -->
           <asp:ListItem Value="S2">S2</asp:ListItem>
           <asp:ListItem Value="S3">S3</asp:ListItem>
</asp:DropDownList>
```

列表项标签中间直接写的内容就是让我们看的，Value属性里面的值是当选中后能够获取到的值

**（2）绑定数据库**

``` C#
<asp:DropDownList ID="DropDownList1" runat="server"></asp:DropDownList>
```

后台代码：

``` C#
DropDownList2.DataSource = 数据源;
DropDownList2.DataTextField = ""; //这个相当于Winform当中DisplayMember
DropDownList2.DataValueField = "";//这个相当于Winform当中ValueMember
DropDownList2.DataBind(); //这个是控件绑定方法，需要通过这个来实现数据绑定
```

#### 4.6 GridView控件

这个相当于Winform当中的DataGridView控件，这个控件也是让我们做查询数据绑定的，它功能比DataGridView强大。

当我们选择三角进行编辑列的时候，该控件包含了多种可用字段

| 字段名         | 说明                                                         |
| -------------- | ------------------------------------------------------------ |
| BoundField     | 这个是我们常规的带有数据绑定的列，里面要求设定两个属性：HeaderText 设置表头信息，DataField用于绑定数据库当中对应的列名 |
| CheckBoxField  | 这个是创建一个带有复选框的列                                 |
| HyperLinkField | 这个是创建一个带有超链接的列                                 |
| ImageField     | 这个是创建一个带有图片的列                                   |

**C#后台绑定代码**

``` C#
控件名.DataSource = 数据源;
控件名.DataBind();
```



### 三. 高级面向对象





## 2. Java OOP





## 3. MySql数据库与JDBC





## 4. JavaScript与Jquery技术





## 5. 通过JSP和Servlet制作网站



